{"version":3,"file":"post.js","sources":["pages/user/post.vue","../../../../biji/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9wb3N0LnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"post-container\">\r\n\r\n    <!-- ÂõæÁâáÈÄâÊã©Âå∫ -->\r\n    <scroll-view scroll-x class=\"image-scroll\">\r\n      <view class=\"image-list\">\r\n        <view v-for=\"(image, index) in imageList\" :key=\"index\" class=\"image-item\">\r\n          <image :src=\"image.url\" mode=\"aspectFill\" class=\"image-thumb\" />\r\n        </view>\r\n        <view v-if=\"imageList.length < 9\" class=\"image-add\" @tap=\"chooseImage\">\r\n          <text class=\"iconfont icon-plus\"></text>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- Ê†áÈ¢ò„ÄÅÊ≠£ÊñáËæìÂÖ• -->\r\n    <view class=\"inputs\">\r\n      <input v-model=\"title\" class=\"title\" placeholder=\"Ê∑ªÂä†Ê†áÈ¢ò\" maxlength=\"50\" />\r\n      <textarea v-model=\"content\" class=\"content\" placeholder=\"Ê∑ªÂä†Ê≠£Êñá\" maxlength=\"500\" />\r\n    </view>\r\n\r\n    <!-- ÂäüËÉΩÊåâÈíÆÂå∫ -->\r\n    <view class=\"func-btns\">\r\n      <view class=\"func-btn\"><text class=\"iconfont\">#</text> ËØùÈ¢ò</view>\r\n      <view class=\"func-btn\"><text class=\"iconfont\">@</text> Áî®Êà∑</view>\r\n      <view class=\"func-btn\"><text class=\"iconfont\">üó≥Ô∏è</text> ÊäïÁ•®</view>\r\n    </view>\r\n\r\n    <!-- ÂàóË°®È°π -->\r\n    <view class=\"list\">\r\n      <view class=\"list-item\" @tap=\"chooseLocation\">\r\n        <text class=\"iconfont icon-location\"></text>\r\n        <text class=\"list-label\">Ê†áËÆ∞Âú∞ÁÇπ</text>\r\n        <text class=\"list-value\">{{ location || '' }}</text>\r\n        <text class=\"iconfont icon-arrow\"></text>\r\n      </view>\r\n      <view class=\"list-item\">\r\n        <text class=\"iconfont icon-lock\"></text>\r\n        <text class=\"list-label\">ÂÖ¨ÂºÄÂèØËßÅ</text>\r\n        <text class=\"iconfont icon-arrow\"></text>\r\n      </view>\r\n      <view class=\"list-item\">\r\n        <text class=\"iconfont icon-setting\"></text>\r\n        <text class=\"list-label\">È´òÁ∫ßÈÄâÈ°π</text>\r\n        <text class=\"iconfont icon-arrow\"></text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- Â∫ïÈÉ®Êìç‰ΩúÊ†è -->\r\n    <view class=\"bottom-bar\">\r\n      <view class=\"bottom-btn\" @tap=\"saveDraft\">\r\n        <text class=\"iconfont icon-draft\"></text>\r\n        Â≠òËçâÁ®ø\r\n      </view>\r\n      <view class=\"bottom-btn\" @tap=\"previewPost\">\r\n        <text class=\"iconfont icon-preview\"></text>\r\n        È¢ÑËßà\r\n      </view>\r\n      <button class=\"publish-btn\" @tap=\"handlePublish\">ÂèëÂ∏ÉÁ¨îËÆ∞</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { useUserStore } from '@/store/modules/user'\r\nimport { usePostStore } from '@/store/modules/post'\r\n\r\nconst userStore = useUserStore()\r\nconst postStore = usePostStore()\r\n\r\nconst imageList = ref([])\r\nconst title = ref('')\r\nconst content = ref('')\r\nconst location = ref('')\r\n\r\nconst chooseImage = () => {\r\n  uni.chooseImage({\r\n    count: 9 - imageList.value.length,\r\n    sizeType: ['compressed'],\r\n    sourceType: ['album', 'camera'],\r\n    success: (res) => {\r\n      const tempFiles = res.tempFilePaths.map(path => ({ url: path }))\r\n      imageList.value.push(...tempFiles)\r\n    }\r\n  })\r\n}\r\n\r\nconst chooseLocation = () => {\r\n  uni.getLocation({\r\n    type: 'wgs84',\r\n    success: () => {\r\n      uni.chooseLocation({\r\n        success: (res) => {\r\n          location.value = res.name\r\n        }\r\n      })\r\n    }\r\n  })\r\n}\r\n\r\nconst saveDraft = () => {\r\n  uni.showToast({ title: 'Â∑≤Â≠ò‰∏∫ËçâÁ®ø', icon: 'none' })\r\n}\r\n\r\nconst previewPost = () => {\r\n  uni.showToast({ title: 'È¢ÑËßàÂäüËÉΩÂºÄÂèë‰∏≠', icon: 'none' })\r\n}\r\n\r\nconst handlePublish = async () => {\r\n  try {\r\n    if (!title.value.trim()) {\r\n      uni.showToast({ title: 'ËØ∑ËæìÂÖ•Ê†áÈ¢ò', icon: 'none' })\r\n      return\r\n    }\r\n    if (!content.value.trim()) {\r\n      uni.showToast({ title: 'ËØ∑ËæìÂÖ•Ê≠£Êñá', icon: 'none' })\r\n      return\r\n    }\r\n    if (imageList.value.length === 0) {\r\n      uni.showToast({ title: 'ËØ∑Ëá≥Â∞ë‰∏ä‰º†‰∏ÄÂº†ÂõæÁâá', icon: 'none' })\r\n      return\r\n    }\r\n\r\n    // ÂàõÂª∫Â∏ñÂ≠êÂØπË±°\r\n    const newPost = {\r\n      id: Date.now().toString(),\r\n      title: title.value,\r\n      content: content.value,\r\n      images: imageList.value.map(image => image.url),\r\n      location: location.value,\r\n      author: {\r\n        username: userStore.getUserInfo.username,\r\n        avatar: userStore.getUserInfo.avatar\r\n      },\r\n      createTime: new Date().toLocaleString(),\r\n      likes: 0,\r\n      isLiked: false\r\n    }\r\n\r\n    // Áõ¥Êé•Ê∑ªÂä†Âà∞ post store\r\n    postStore.addPost(newPost)\r\n    \r\n    // Êõ¥Êñ∞Áî®Êà∑Â∏ñÂ≠êÊï∞Èáè\r\n    const currentPosts = userStore.getUserInfo.posts || 0\r\n    userStore.updatePostsCount(currentPosts + 1)\r\n\r\n    // Ê∏ÖÁ©∫Ë°®Âçï\r\n    title.value = ''\r\n    content.value = ''\r\n    imageList.value = []\r\n    location.value = ''\r\n\r\n    uni.showToast({ title: 'ÂèëÂ∏ÉÊàêÂäü', icon: 'success' })\r\n    uni.switchTab({ url: '/pages/user/my' })\r\n  } catch (error) {\r\n    console.error('ÂèëÂ∏ÉÂ§±Ë¥•:', error)\r\n    uni.showToast({ title: 'ÂèëÂ∏ÉÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', icon: 'none' })\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style>\r\n.post-container {\r\n  min-height: 100vh;\r\n  background: #fff;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding-bottom: 160rpx;\r\n}\r\n.header {\r\n  height: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  padding-left: 20rpx;\r\n}\r\n.icon-back:before { content: '\\2039'; font-size: 48rpx; color: #222; }\r\n\r\n.image-scroll {\r\n  width: 100vw;\r\n  margin-top: 10rpx;\r\n  margin-bottom: 20rpx;\r\n}\r\n.image-list {\r\n  display: flex;\r\n  align-items: center;\r\n  padding-left: 20rpx;\r\n  flex-wrap: nowrap; \r\n}\r\n.image-item {\r\n  width: 140rpx;\r\n  height: 140rpx;\r\n  margin-right: 20rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  background: #f5f5f5;\r\n  flex-shrink: 0;\r\n}\r\n.image-thumb {\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 16rpx;\r\n}\r\n.image-add {\r\n  width: 140rpx;\r\n  height: 140rpx;\r\n  background: #fafbfc;\r\n  border: 2rpx dashed #e5e5e5;\r\n  border-radius: 16rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #ccc;\r\n  font-size: 60rpx;\r\n  flex-shrink: 0;\r\n}\r\n.icon-plus:before { content: '+'; font-size: 60rpx; color: #ccc; }\r\n.inputs {\r\n  padding: 0 32rpx;\r\n  margin-bottom: 30rpx;\r\n  margin-top: 15rpx;\r\n}\r\n.title {\r\n  width: 100%;\r\n  font-size: 36rpx;\r\n  color: #bbb;\r\n  font-weight: 500;\r\n  margin-bottom: 16rpx;\r\n  border: none;\r\n  background: none;\r\n  padding-bottom: 10rpx;\r\n}\r\n.content {\r\n  width: 100%;\r\n  min-height: 100rpx;\r\n  font-size: 28rpx;\r\n  color: #bbb;\r\n  border: none;\r\n  background: none;\r\n}\r\n\r\n.tags-scroll {\r\n  width: 100vw;\r\n  margin-bottom: 10rpx;\r\n}\r\n.tags-list {\r\n  display: flex;\r\n  align-items: center;\r\n  padding-left: 20rpx;\r\n}\r\n.tag {\r\n  background: #f5f5f5;\r\n  color: #888;\r\n  font-size: 26rpx;\r\n  border-radius: 32rpx;\r\n  padding: 10rpx 28rpx;\r\n  margin-right: 16rpx;\r\n}\r\n\r\n.func-btns {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 20rpx;\r\n  margin-bottom: 10rpx;\r\n}\r\n.func-btn {\r\n  background: #f5f5f5;\r\n  color: #888;\r\n  font-size: 28rpx;\r\n  border-radius: 32rpx;\r\n  padding: 10rpx 28rpx;\r\n  margin-right: 16rpx;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.list {\r\n  margin: 20rpx 0 0 0;\r\n  background: #fff;\r\n}\r\n.list-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 32rpx 32rpx;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n  font-size: 30rpx;\r\n  color: #333;\r\n}\r\n.list-item:last-child { border-bottom: none; }\r\n.list-label { margin-left: 16rpx; color: #333; }\r\n.list-value { flex: 1; color: #888; margin-left: 20rpx; }\r\n.icon-location:before { content: '\\1F4CD'; margin-right: 8rpx; }\r\n.icon-lock:before { content: '\\1F512'; margin-right: 8rpx; }\r\n.icon-setting:before { content: '\\2699'; margin-right: 8rpx; }\r\n.icon-arrow:before { content: '\\203A'; color: #bbb; margin-left: 8rpx; }\r\n\r\n.bottom-bar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: #fff;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 20rpx 32rpx 40rpx 32rpx;\r\n  z-index: 100;\r\n}\r\n.bottom-btn {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  color: #888;\r\n  font-size: 24rpx;\r\n  margin-right: 32rpx;\r\n}\r\n.icon-draft:before { content: '\\1F4E5'; font-size: 36rpx; }\r\n.icon-preview:before { content: '\\1F441'; font-size: 36rpx; }\r\n.publish-btn {\r\n  flex: 1;\r\n  margin-left: 32rpx;\r\n  height: 88rpx;\r\n  background: #DB9EA2;\r\n  color: #fff;\r\n  border-radius: 44rpx;\r\n  font-size: 32rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border: none;\r\n}\r\n</style>\r\n  ","import MiniProgramPage from 'D:/Git clone/TravelDiaryPlatform/app/rednote/pages/user/post.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","usePostStore","ref","uni","MiniProgramPage"],"mappings":";;;;;;;AAoEA,UAAM,YAAYA,mBAAAA,aAAc;AAChC,UAAM,YAAYC,mBAAAA,aAAc;AAEhC,UAAM,YAAYC,cAAG,IAAC,EAAE;AACxB,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,UAAUA,cAAG,IAAC,EAAE;AACtB,UAAM,WAAWA,cAAG,IAAC,EAAE;AAEvB,UAAM,cAAc,MAAM;AACxBC,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO,IAAI,UAAU,MAAM;AAAA,QAC3B,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AAChB,gBAAM,YAAY,IAAI,cAAc,IAAI,WAAS,EAAE,KAAK,KAAI,EAAG;AAC/D,oBAAU,MAAM,KAAK,GAAG,SAAS;AAAA,QAClC;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,iBAAiB,MAAM;AAC3BA,oBAAAA,MAAI,YAAY;AAAA,QACd,MAAM;AAAA,QACN,SAAS,MAAM;AACbA,wBAAAA,MAAI,eAAe;AAAA,YACjB,SAAS,CAAC,QAAQ;AAChB,uBAAS,QAAQ,IAAI;AAAA,YACtB;AAAA,UACT,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,YAAY,MAAM;AACtBA,oBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,IAChD;AAEA,UAAM,cAAc,MAAM;AACxBA,oBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAAA,IAClD;AAEA,UAAM,gBAAgB,YAAY;AAChC,UAAI;AACF,YAAI,CAAC,MAAM,MAAM,QAAQ;AACvBA,wBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,QACD;AACD,YAAI,CAAC,QAAQ,MAAM,QAAQ;AACzBA,wBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,QACD;AACD,YAAI,UAAU,MAAM,WAAW,GAAG;AAChCA,wBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAClD;AAAA,QACD;AAGD,cAAM,UAAU;AAAA,UACd,IAAI,KAAK,IAAK,EAAC,SAAU;AAAA,UACzB,OAAO,MAAM;AAAA,UACb,SAAS,QAAQ;AAAA,UACjB,QAAQ,UAAU,MAAM,IAAI,WAAS,MAAM,GAAG;AAAA,UAC9C,UAAU,SAAS;AAAA,UACnB,QAAQ;AAAA,YACN,UAAU,UAAU,YAAY;AAAA,YAChC,QAAQ,UAAU,YAAY;AAAA,UAC/B;AAAA,UACD,aAAY,oBAAI,KAAM,GAAC,eAAgB;AAAA,UACvC,OAAO;AAAA,UACP,SAAS;AAAA,QACV;AAGD,kBAAU,QAAQ,OAAO;AAGzB,cAAM,eAAe,UAAU,YAAY,SAAS;AACpD,kBAAU,iBAAiB,eAAe,CAAC;AAG3C,cAAM,QAAQ;AACd,gBAAQ,QAAQ;AAChB,kBAAU,QAAQ,CAAE;AACpB,iBAAS,QAAQ;AAEjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChDA,sBAAAA,MAAI,UAAU,EAAE,KAAK,iBAAgB,CAAE;AAAA,MACxC,SAAQ,OAAO;AACdA,sBAAAA,mDAAc,SAAS,KAAK;AAC5BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AAAA,MAClD;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;AC9JA,GAAG,WAAWC,SAAe;"}