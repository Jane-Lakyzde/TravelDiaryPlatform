{"version":3,"file":"detail.js","sources":["pages/post/detail.vue","../../../../biji/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcG9zdC9kZXRhaWwudnVl"],"sourcesContent":["<template>\r\n  <view class=\"post-detail\">\r\n    <!-- 顶部导航栏（含作者信息、关注、分享） -->\r\n    <view class=\"header\">\r\n      <text class=\"iconfont icon-back\" @tap=\"goBack\"></text>\r\n      <image class=\"avatar\" :src=\"post?.author?.avatar || '/static/images/touxiang.jpg'\" />\r\n      <text class=\"username\">{{ post?.author?.username }}</text>\r\n      <button class=\"follow-btn\" :class=\"{ followed: isFollowed }\" @tap=\"toggleFollow\">\r\n        {{ isFollowed ? '已关注' : '关注' }}\r\n      </button>\r\n      <text class=\"iconfont icon-share\" @tap=\"handleShare\"></text>\r\n    </view>\r\n\r\n    <!-- 帖子内容区 -->\r\n    <scroll-view class=\"content\" scroll-y>\r\n      <view class=\"post-content\">\r\n        <template v-if=\"post?.video\">\r\n          <view class=\"detail-video\">\r\n            <video :src=\"post.video\" controls autoplay style=\"width: 100%; border-radius: 18rpx; background: #eee;\" />\r\n          </view>\r\n        </template>\r\n        <template v-else>\r\n          <view class=\"image-swiper\" v-if=\"post?.images?.length\">\r\n            <swiper :indicator-dots=\"post.images.length > 1\" :autoplay=\"false\" class=\"swiper-box\">\r\n              <swiper-item v-for=\"(img, idx) in post.images\" :key=\"idx\">\r\n                <image :src=\"img\" class=\"post-image\" mode=\"aspectFill\" @tap=\"previewImage(idx)\" />\r\n              </swiper-item>\r\n            </swiper>\r\n          </view>\r\n        </template>\r\n        <text class=\"title\">{{ post?.title }}</text>\r\n        <text class=\"text\">{{ post?.content }}</text>\r\n        <view v-if=\"post?.location\" class=\"post-location\">\r\n          <text class=\"iconfont icon-location\"></text>\r\n          <text>{{ post.location }}</text>\r\n        </view>\r\n      </view>\r\n      <!-- 评论区 -->\r\n      <view class=\"comments-section\">\r\n        <view class=\"section-title\">共 {{ comments.length }} 条评论</view>\r\n        <view class=\"comment-list\">\r\n          <view v-for=\"comment in comments\" :key=\"comment.id\" class=\"comment-item\">\r\n            <image class=\"comment-avatar\" :src=\"comment.user.avatar || '/static/images/touxiang.jpg'\" />\r\n            <view class=\"comment-content\">\r\n              <view class=\"comment-user\">\r\n                <text class=\"username\">{{ comment.user.username }}</text>\r\n                <text class=\"time\">{{ comment.createTime }}</text>\r\n              </view>\r\n              <text class=\"comment-text\">{{ comment.content }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- 底部操作栏 -->\r\n    <view class=\"footer\">\r\n      <input class=\"comment-input\" v-model=\"commentText\" placeholder=\"说点什么...\" @confirm=\"sendComment\" />\r\n      <view class=\"footer-actions\">\r\n        <text class=\"iconfont icon-like\" :class=\"{ liked: isLiked }\" @tap=\"handleLike\"></text>\r\n        <text class=\"count\">{{ post?.likes }}</text>\r\n        <text class=\"iconfont icon-star\"></text>\r\n        <text class=\"count\">{{ post?.stars || 0 }}</text>\r\n        <text class=\"iconfont icon-comment\"></text>\r\n        <text class=\"count\">{{ comments.length }}</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { usePostStore } from '@/store/modules/post'\r\nimport { useUserStore } from '@/store/modules/user'\r\n\r\nconst postStore = usePostStore()\r\nconst userStore = useUserStore()\r\n\r\nconst post = ref(null)\r\nconst comments = ref([])\r\nconst commentText = ref('')\r\nconst isLiked = ref(false)\r\nconst isFollowed = ref(false)\r\n\r\n// 获取帖子详情\r\nconst getPostDetail = (id) => {\r\n  const postDetail = postStore.getPostDetail(id)\r\n  if (postDetail) {\r\n    post.value = postDetail\r\n    isLiked.value = postDetail.isLiked\r\n    isFollowed.value = !!postDetail.isFollowed\r\n  }\r\n}\r\n\r\n// 获取评论列表\r\nconst getComments = (postId) => {\r\n  comments.value = postStore.getPostComments(postId)\r\n}\r\n\r\n// 发送评论\r\nconst sendComment = () => {\r\n  if (!commentText.value.trim()) {\r\n    uni.showToast({ title: '请输入评论内容', icon: 'none' })\r\n    return\r\n  }\r\n  const newComment = {\r\n    id: Date.now().toString(),\r\n    content: commentText.value,\r\n    createTime: new Date().toLocaleString(),\r\n    user: {\r\n      username: userStore.getUserInfo.username,\r\n      avatar: userStore.getUserInfo.avatar\r\n    }\r\n  }\r\n  postStore.addComment(post.value.id, newComment)\r\n  comments.value = postStore.getPostComments(post.value.id)\r\n  commentText.value = ''\r\n  uni.showToast({ title: '评论成功', icon: 'success' })\r\n}\r\n\r\n// 点赞\r\nconst handleLike = () => {\r\n  postStore.toggleLike(post.value.id)\r\n  isLiked.value = post.value.isLiked\r\n}\r\n\r\n// 关注/取消关注\r\nconst toggleFollow = () => {\r\n  isFollowed.value = !isFollowed.value\r\n  post.value.isFollowed = isFollowed.value\r\n  // 同步到我的页面关注数\r\n  if (isFollowed.value) {\r\n    userStore.userInfo.following = (userStore.userInfo.following || 0) + 1\r\n  } else {\r\n    userStore.userInfo.following = Math.max((userStore.userInfo.following || 1) - 1, 0)\r\n  }\r\n}\r\n\r\n// 分享\r\nconst handleShare = () => {\r\n  uni.showShareMenu({\r\n    withShareTicket: true,\r\n    menus: ['shareAppMessage', 'shareTimeline']\r\n  })\r\n}\r\n\r\n// 返回上一页\r\nconst goBack = () => {\r\n  uni.navigateBack()\r\n}\r\n\r\n// 预览图片\r\nconst previewImage = (index) => {\r\n  uni.previewImage({\r\n    urls: post.value.images,\r\n    current: index\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  const pages = getCurrentPages()\r\n  const currentPage = pages[pages.length - 1]\r\n  const postId = currentPage.options.id\r\n  getPostDetail(postId)\r\n  getComments(postId)\r\n})\r\n</script>\r\n\r\n<style>\r\n.post-detail {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100vh;\r\n  background: #fff;\r\n}\r\n.header {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 100rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  background: #fff;\r\n  z-index: 100;\r\n  padding: 0 24rpx;\r\n  border-bottom: 1rpx solid #ececec;\r\n}\r\n.icon-back {\r\n  font-size: 44rpx;\r\n  color: #222;\r\n  margin-right: 18rpx;\r\n}\r\n.avatar {\r\n  width: 64rpx;\r\n  height: 64rpx;\r\n  border-radius: 50%;\r\n  margin-right: 16rpx;\r\n}\r\n.username {\r\n  color: #222;\r\n  font-size: 30rpx;\r\n  font-weight: 500;\r\n  margin-right: 18rpx;\r\n}\r\n.follow-btn {\r\n  background: #ff2442;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 32rpx;\r\n  font-size: 26rpx;\r\n  padding: 0 32rpx;\r\n  height: 56rpx;\r\n  line-height: 56rpx;\r\n  margin-right: 18rpx;\r\n}\r\n.follow-btn.followed {\r\n  background: #eee;\r\n  color: #888;\r\n}\r\n.icon-share {\r\n  font-size: 40rpx;\r\n  color: #222;\r\n}\r\n.content {\r\n  flex: 1;\r\n  margin-top: 100rpx;\r\n  margin-bottom: 110rpx;\r\n  padding: 0;\r\n  background: #f7f7f7;\r\n}\r\n.post-content {\r\n  background: #fff;\r\n  border-radius: 32rpx;\r\n  margin: 24rpx 24rpx 0 24rpx;\r\n  padding: 32rpx 28rpx 24rpx 28rpx;\r\n  color: #222;\r\n}\r\n.image-swiper {\r\n  width: 100%;\r\n  height: 420rpx;\r\n  margin-bottom: 24rpx;\r\n  border-radius: 18rpx;\r\n  overflow: hidden;\r\n}\r\n.swiper-box {\r\n  width: 100%;\r\n  height: 420rpx;\r\n  border-radius: 18rpx;\r\n}\r\n.post-image {\r\n  width: 100%;\r\n  height: 420rpx;\r\n  object-fit: cover;\r\n  border-radius: 18rpx;\r\n  background: #eee;\r\n}\r\n.title {\r\n  font-size: 36rpx;\r\n  font-weight: bold;\r\n  color: #222;\r\n  margin-bottom: 18rpx;\r\n  display: block;\r\n}\r\n.text {\r\n  font-size: 28rpx;\r\n  color: #444;\r\n  line-height: 1.7;\r\n  margin-bottom: 18rpx;\r\n  display: block;\r\n  word-break: break-all;\r\n}\r\n.comments-section {\r\n  margin: 32rpx 24rpx 0 24rpx;\r\n  background: #fff;\r\n  border-radius: 32rpx;\r\n  padding: 24rpx 24rpx 0 24rpx;\r\n}\r\n.section-title {\r\n  font-size: 28rpx;\r\n  color: #888;\r\n  margin-bottom: 24rpx;\r\n}\r\n.comment-list {\r\n  width: 100%;\r\n}\r\n.comment-item {\r\n  display: flex;\r\n  margin-bottom: 28rpx;\r\n}\r\n.comment-avatar {\r\n  width: 48rpx;\r\n  height: 48rpx;\r\n  border-radius: 50%;\r\n  margin-right: 16rpx;\r\n}\r\n.comment-content {\r\n  flex: 1;\r\n  min-width: 0;\r\n}\r\n.comment-user {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 6rpx;\r\n}\r\n.comment-user .username {\r\n  color: #222;\r\n  font-size: 26rpx;\r\n  margin-right: 12rpx;\r\n}\r\n.comment-user .time {\r\n  color: #aaa;\r\n  font-size: 22rpx;\r\n}\r\n.comment-text {\r\n  color: #444;\r\n  font-size: 26rpx;\r\n  line-height: 1.6;\r\n  word-break: break-all;\r\n}\r\n.footer {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  height: 110rpx;\r\n  background: #fff;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 0 24rpx;\r\n  border-top: 1rpx solid #ececec;\r\n  z-index: 200;\r\n}\r\n.comment-input {\r\n  flex: 1;\r\n  height: 72rpx;\r\n  background: #f7f7f7;\r\n  border-radius: 36rpx;\r\n  padding: 0 28rpx;\r\n  color: #222;\r\n  font-size: 28rpx;\r\n  border: none;\r\n  margin-right: 18rpx;\r\n}\r\n.footer-actions {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 18rpx;\r\n}\r\n.icon-like, .icon-star, .icon-comment {\r\n  font-size: 38rpx;\r\n  color: #888;\r\n}\r\n.icon-like.liked {\r\n  color: #ff2442;\r\n}\r\n.count {\r\n  color: #888;\r\n  font-size: 24rpx;\r\n  margin-left: 4rpx;\r\n}\r\n@font-face {\r\n  font-family: 'iconfont';\r\n  src: url('/static/fonts/iconfont.ttf') format('woff2');\r\n}\r\n.iconfont {\r\n  font-family: 'iconfont';\r\n}\r\n.icon-back::before { content: '\\e697'; }\r\n.icon-share::before { content: '\\e615'; }\r\n.icon-like::before { content: '\\e61b'; }\r\n.icon-like.liked ::before { content: '\\e638'; }\r\n.icon-star::before { content: '\\e646'; }\r\n.icon-comment::before { content: '\\e645'; }\r\n.post-location {\r\n  display: flex;\r\n  align-items: center;\r\n  color: #888;\r\n  font-size: 26rpx;\r\n  margin: 18rpx 0 0 0;\r\n}\r\n.icon-location::before { content: '\\e64e'; color: #ff2442; margin-right: 8rpx; }\r\n</style> ","import MiniProgramPage from 'D:/Git clone/TravelDiaryPlatform/app/rednote/pages/post/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["usePostStore","useUserStore","ref","uni","onMounted","MiniProgramPage"],"mappings":";;;;;;;AA2EA,UAAM,YAAYA,mBAAAA,aAAc;AAChC,UAAM,YAAYC,mBAAAA,aAAc;AAEhC,UAAM,OAAOC,cAAG,IAAC,IAAI;AACrB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,cAAcA,cAAG,IAAC,EAAE;AAC1B,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,aAAaA,cAAG,IAAC,KAAK;AAG5B,UAAM,gBAAgB,CAAC,OAAO;AAC5B,YAAM,aAAa,UAAU,cAAc,EAAE;AAC7C,UAAI,YAAY;AACd,aAAK,QAAQ;AACb,gBAAQ,QAAQ,WAAW;AAC3B,mBAAW,QAAQ,CAAC,CAAC,WAAW;AAAA,MACjC;AAAA,IACH;AAGA,UAAM,cAAc,CAAC,WAAW;AAC9B,eAAS,QAAQ,UAAU,gBAAgB,MAAM;AAAA,IACnD;AAGA,UAAM,cAAc,MAAM;AACxB,UAAI,CAAC,YAAY,MAAM,QAAQ;AAC7BC,sBAAG,MAAC,UAAU,EAAE,OAAO,WAAW,MAAM,QAAQ;AAChD;AAAA,MACD;AACD,YAAM,aAAa;AAAA,QACjB,IAAI,KAAK,IAAK,EAAC,SAAU;AAAA,QACzB,SAAS,YAAY;AAAA,QACrB,aAAY,oBAAI,KAAM,GAAC,eAAgB;AAAA,QACvC,MAAM;AAAA,UACJ,UAAU,UAAU,YAAY;AAAA,UAChC,QAAQ,UAAU,YAAY;AAAA,QAC/B;AAAA,MACF;AACD,gBAAU,WAAW,KAAK,MAAM,IAAI,UAAU;AAC9C,eAAS,QAAQ,UAAU,gBAAgB,KAAK,MAAM,EAAE;AACxD,kBAAY,QAAQ;AACpBA,oBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAAA,IAClD;AAGA,UAAM,aAAa,MAAM;AACvB,gBAAU,WAAW,KAAK,MAAM,EAAE;AAClC,cAAQ,QAAQ,KAAK,MAAM;AAAA,IAC7B;AAGA,UAAM,eAAe,MAAM;AACzB,iBAAW,QAAQ,CAAC,WAAW;AAC/B,WAAK,MAAM,aAAa,WAAW;AAEnC,UAAI,WAAW,OAAO;AACpB,kBAAU,SAAS,aAAa,UAAU,SAAS,aAAa,KAAK;AAAA,MACzE,OAAS;AACL,kBAAU,SAAS,YAAY,KAAK,KAAK,UAAU,SAAS,aAAa,KAAK,GAAG,CAAC;AAAA,MACnF;AAAA,IACH;AAGA,UAAM,cAAc,MAAM;AACxBA,oBAAAA,MAAI,cAAc;AAAA,QAChB,iBAAiB;AAAA,QACjB,OAAO,CAAC,mBAAmB,eAAe;AAAA,MAC9C,CAAG;AAAA,IACH;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,aAAc;AAAA,IACpB;AAGA,UAAM,eAAe,CAAC,UAAU;AAC9BA,oBAAAA,MAAI,aAAa;AAAA,QACf,MAAM,KAAK,MAAM;AAAA,QACjB,SAAS;AAAA,MACb,CAAG;AAAA,IACH;AAEAC,kBAAAA,UAAU,MAAM;AACd,YAAM,QAAQ,gBAAiB;AAC/B,YAAM,cAAc,MAAM,MAAM,SAAS,CAAC;AAC1C,YAAM,SAAS,YAAY,QAAQ;AACnC,oBAAc,MAAM;AACpB,kBAAY,MAAM;AAAA,IACpB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpKD,GAAG,WAAWC,SAAe;"}