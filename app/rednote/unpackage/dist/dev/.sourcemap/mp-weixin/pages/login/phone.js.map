{"version":3,"file":"phone.js","sources":["pages/login/phone.vue","../../../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vcGhvbmUudnVl"],"sourcesContent":["<template>\r\n    <view class=\"phone-container\">\r\n      <!-- 顶部 -->\r\n      <view class=\"phone-header\">\r\n        <text class=\"iconfont icon-back\" @tap=\"goBack\"></text>\r\n        <text class=\"phone-help\" @tap=\"toggleHelp\">遇到问题</text>\r\n        <view v-if=\"showHelp\" class=\"dropdown-menu\" @tap.stop>\r\n          <view class=\"dropdown-item\">无法接收验证码</view>\r\n          <view class=\"dropdown-item\">微信登录失败</view>\r\n          <view class=\"dropdown-item\">联系客服</view>\r\n        </view>\r\n      </view>\r\n      <!-- 标题 -->\r\n      <view class=\"phone-title\">手机号登录</view>\r\n      <view class=\"phone-subtitle\">未注册手机号将自动注册</view>\r\n      <!-- 手机号输入 -->\r\n      <view class=\"input-row\">\r\n        <picker mode=\"selector\" :range=\"areaCodes\" :value=\"areaIndex\" @change=\"onAreaChange\">\r\n          <view class=\"area-code\">{{ areaCodes[areaIndex] }}</view>\r\n        </picker>\r\n        <input class=\"phone-input\" v-model=\"phone\" type=\"number\" maxlength=\"11\" placeholder=\"手机号\" />\r\n      </view>\r\n      <!-- 密码输入 -->\r\n      <view class=\"input-row\">\r\n        <input class=\"pwd-input\" v-model=\"password\" type=\"password\" maxlength=\"20\" placeholder=\"密码\" />\r\n      </view>\r\n      <!-- 确定按钮 -->\r\n      <button class=\"confirm-btn\" :disabled=\"!canSubmit\" @tap=\"onConfirm\">确定</button>\r\n      <!-- 其它 -->\r\n      <view class=\"phone-links\">\r\n        <text class=\"link\" @tap=\"goPwdLogin\">密码登录</text>\r\n        <text class=\"link right\">手机号不可用？</text>\r\n      </view>\r\n      <!-- 协议勾选 -->\r\n      <view class=\"phone-protocol\">\r\n        <text class=\"checkbox\" :class=\"{checked: checked}\" @tap=\"checked = !checked\">\r\n          <text v-if=\"checked\" class=\"iconfont icon-checked\"></text>\r\n          <text v-else class=\"iconfont icon-unchecked\"></text>\r\n        </text>\r\n        <text class=\"protocol-text\">已阅读并同意《用户协议》《隐私政策》《买家须知》。</text>\r\n      </view>\r\n    </view>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref, computed } from 'vue'\r\n  import { phoneLogin } from '@/api/user' // 导入手机号登录API\r\n\r\n  const showHelp = ref(false)\r\n  const checked = ref(false)\r\n  const phone = ref('')\r\n  const password = ref('')\r\n  const areaCodes = ref(['+86', '+852', '+853', '+886'])\r\n  const areaIndex = ref(0)\r\n  const loading = ref(false)\r\n  \r\n  const goBack = () => {\r\n    uni.navigateBack()\r\n  }\r\n  const toggleHelp = () => {\r\n    showHelp.value = !showHelp.value\r\n  }\r\n  const onAreaChange = e => {\r\n    areaIndex.value = e.detail.value\r\n  }\r\n  const goPwdLogin = () => {\r\n    uni.showToast({ title: '请用手机号+密码登录', icon: 'none' })\r\n  }\r\n  const canSubmit = computed(() => {\r\n    return phone.value.length === 11 && password.value.length >= 6 && checked.value\r\n  })\r\n  const onConfirm = async () => {\r\n    if (phone.value.length !== 11) {\r\n      uni.showToast({ title: '请输入11位手机号', icon: 'none' })\r\n      return\r\n    }\r\n    if (password.value.length < 6) {\r\n      uni.showToast({ title: '密码长度至少6位', icon: 'none' })\r\n      return\r\n    }\r\n    if (!checked.value) {\r\n      uni.showToast({ title: '请勾选协议', icon: 'none' })\r\n      return\r\n    }\r\n    if (!canSubmit.value) return\r\n    try {\r\n      const res = await phoneLogin({\r\n        phone: phone.value,\r\n        password: password.value\r\n      })\r\n      // 登录成功后存储 token\r\n      uni.setStorageSync('token', res.token)\r\n      uni.showToast({ title: '登录成功', icon: 'success' })\r\n      uni.reLaunch({ url: '/pages/user/home' })\r\n    } catch (err) {\r\n      uni.showToast({ title: err.message || '登录失败', icon: 'none' })\r\n      console.error('登录错误：', err)\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style>\r\n  @font-face {\r\n    font-family: 'iconfont';\r\n    src: url('/static/fonts/iconfont.ttf') format('truetype');\r\n  }\r\n  .iconfont {\r\n    font-family: 'iconfont';\r\n    font-size: 32rpx;\r\n  }\r\n  .phone-container {\r\n    min-height: 100vh;\r\n    background: #fff;\r\n    padding: 0 40rpx;\r\n    box-sizing: border-box;\r\n  }\r\n  .phone-header {\r\n    width: 100vw;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: flex-start;\r\n    padding: 40rpx 0 0 0;\r\n    position: relative;\r\n  }\r\n  .icon-back:before { content: '\\2039'; font-size: 48rpx; color: #222; }\r\n  .phone-help {\r\n    font-size: 28rpx;\r\n    color: #999;\r\n    position: absolute;\r\n    right: 0;\r\n  }\r\n  .dropdown-menu {\r\n    position: absolute;\r\n    top: 60rpx;\r\n    right: 0;\r\n    background: #fff;\r\n    border-radius: 16rpx;\r\n    box-shadow: 0 2rpx 12rpx rgba(0,0,0,0.08);\r\n    z-index: 10;\r\n    min-width: 220rpx;\r\n  }\r\n  .dropdown-item {\r\n    padding: 28rpx 40rpx;\r\n    font-size: 28rpx;\r\n    color: #333;\r\n    border-bottom: 1rpx solid #f0f0f0;\r\n  }\r\n  .dropdown-item:last-child { border-bottom: none; }\r\n  .phone-title {\r\n    font-size: 44rpx;\r\n    font-weight: bold;\r\n    color: #222;\r\n    margin-top: 60rpx;\r\n    margin-bottom: 12rpx;\r\n  }\r\n  .phone-subtitle {\r\n    color: #bbb;\r\n    font-size: 26rpx;\r\n    margin-bottom: 60rpx;\r\n  }\r\n  .input-row {\r\n    display: flex;\r\n    align-items: center;\r\n    border-bottom: 2rpx solid #eee;\r\n    margin-bottom: 40rpx;\r\n  }\r\n  .area-code {\r\n    font-size: 32rpx;\r\n    color: #222;\r\n    margin-right: 16rpx;\r\n    min-width: 80rpx;\r\n  }\r\n  .phone-input {\r\n    flex: 1;\r\n    height: 80rpx;\r\n    font-size: 32rpx;\r\n    border: none;\r\n    outline: none;\r\n    background: transparent;\r\n    color: #222;\r\n  }\r\n  .pwd-input {\r\n    flex: 1;\r\n    height: 80rpx;\r\n    font-size: 32rpx;\r\n    border: none;\r\n    outline: none;\r\n    background: transparent;\r\n    color: #222;\r\n  }\r\n  .confirm-btn {\r\n    width: 100%;\r\n    height: 88rpx;\r\n    background: #b2e6e0;\r\n    color: #fff;\r\n    font-size: 32rpx;\r\n    border-radius: 8rpx;\r\n    margin: 40rpx 0 0 0;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n  .confirm-btn:disabled {\r\n    background: #e0e0e0;\r\n    color: #aaa;\r\n  }\r\n  .phone-links {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin: 32rpx 0 0 0;\r\n    color: #888;\r\n    font-size: 28rpx;\r\n  }\r\n  .link {\r\n    color: #888;\r\n  }\r\n  .link.right {\r\n    margin-left: auto;\r\n  }\r\n  .phone-protocol {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-top: 60rpx;\r\n    font-size: 24rpx;\r\n    color: #888;\r\n  }\r\n  .checkbox {\r\n    width: 36rpx;\r\n    height: 36rpx;\r\n    border-radius: 50%;\r\n    border: 2rpx solid #bbb;\r\n    margin-right: 16rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background: #fff;\r\n  }\r\n  .checkbox.checked {\r\n    border-color: #3cc51f;\r\n    background: #3cc51f;\r\n  }\r\n  .icon-checked:before { content: '\\2714'; color: #fff; font-size: 28rpx; }\r\n  .icon-unchecked:before { content: ''; }\r\n  .protocol-text {\r\n    color: #888;\r\n    font-size: 24rpx;\r\n  }\r\n  </style>\r\n  ","import MiniProgramPage from 'C:/Users/22533/Desktop/TravelDiaryPlatform/app/rednote/pages/login/phone.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","computed","phoneLogin","MiniProgramPage"],"mappings":";;;;;;AAgDE,UAAM,WAAWA,cAAG,IAAC,KAAK;AAC1B,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,WAAWA,cAAG,IAAC,EAAE;AACvB,UAAM,YAAYA,cAAAA,IAAI,CAAC,OAAO,QAAQ,QAAQ,MAAM,CAAC;AACrD,UAAM,YAAYA,cAAG,IAAC,CAAC;AACPA,kBAAAA,IAAI,KAAK;AAEzB,UAAM,SAAS,MAAM;AACnBC,oBAAAA,MAAI,aAAc;AAAA,IACnB;AACD,UAAM,aAAa,MAAM;AACvB,eAAS,QAAQ,CAAC,SAAS;AAAA,IAC5B;AACD,UAAM,eAAe,OAAK;AACxB,gBAAU,QAAQ,EAAE,OAAO;AAAA,IAC5B;AACD,UAAM,aAAa,MAAM;AACvBA,oBAAG,MAAC,UAAU,EAAE,OAAO,cAAc,MAAM,QAAQ;AAAA,IACpD;AACD,UAAM,YAAYC,cAAAA,SAAS,MAAM;AAC/B,aAAO,MAAM,MAAM,WAAW,MAAM,SAAS,MAAM,UAAU,KAAK,QAAQ;AAAA,IAC9E,CAAG;AACD,UAAM,YAAY,YAAY;AAC5B,UAAI,MAAM,MAAM,WAAW,IAAI;AAC7BD,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,QAAQ;AAClD;AAAA,MACD;AACD,UAAI,SAAS,MAAM,SAAS,GAAG;AAC7BA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjD;AAAA,MACD;AACD,UAAI,CAAC,QAAQ,OAAO;AAClBA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAC9C;AAAA,MACD;AACD,UAAI,CAAC,UAAU;AAAO;AACtB,UAAI;AACF,cAAM,MAAM,MAAME,oBAAW;AAAA,UAC3B,OAAO,MAAM;AAAA,UACb,UAAU,SAAS;AAAA,QAC3B,CAAO;AAEDF,sBAAAA,MAAI,eAAe,SAAS,IAAI,KAAK;AACrCA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChDA,sBAAAA,MAAI,SAAS,EAAE,KAAK,mBAAkB,CAAE;AAAA,MACzC,SAAQ,KAAK;AACZA,4BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAC5DA,sBAAAA,MAAA,MAAA,SAAA,+BAAc,SAAS,GAAG;AAAA,MAC3B;AAAA,IACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjGH,GAAG,WAAWG,SAAe;"}