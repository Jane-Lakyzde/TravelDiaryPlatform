{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../../../biji/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-container\">\r\n    <!-- 顶部 -->\r\n    <view class=\"login-header\">\r\n      <text class=\"iconfont icon-back\">×</text>\r\n      <text class=\"login-help\" @tap=\"toggleHelp\">遇到问题</text>\r\n      <view v-if=\"showHelp\" class=\"dropdown-menu\" @tap.stop>\r\n        <view class=\"dropdown-item\">无法接收验证码</view>\r\n        <view class=\"dropdown-item\">微信登录失败</view>\r\n        <view class=\"dropdown-item\">联系客服</view>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- LOGO 区域 - 留出空间给图片 -->\r\n    <view class=\"login-logo\">\r\n      <image src=\"/static/images/logo.png\" mode=\"aspectFit\" />\r\n    </view>\r\n    \r\n    <!-- 登录按钮区域 -->\r\n    <view class=\"login-buttons-area\">\r\n      <!-- 微信一键登录 -->\r\n      <button class=\"login-btn wx-btn\" @tap=\"wxLogin\">\r\n        <view class=\"btn-content\">\r\n          <text class=\"iconfont icon-wechat white-icon\"></text>\r\n          <text class=\"btn-text\">微信一键登录</text>\r\n        </view>\r\n      </button>\r\n      \r\n      <!-- 手机号登录 -->\r\n      <view class=\"login-phone\" @tap=\"goPhoneLogin\">手机号登录</view>\r\n      \r\n      <!-- 其它方式登录 -->\r\n      <view class=\"login-other-title\">其它方式登录</view>\r\n      <view class=\"login-other-icons\">\r\n        <view class=\"icon-wrap\" @tap=\"toggleOtherMenu\">\r\n          <text class=\"iconfont icon-wechat\"></text>\r\n        </view>\r\n        <view class=\"icon-wrap\" @tap=\"toggleOtherMenu\">\r\n          <text class=\"iconfont icon-weibo\"></text>\r\n        </view>\r\n        <view class=\"icon-wrap\" @tap=\"toggleOtherMenu\">\r\n          <text class=\"iconfont icon-qq\"></text>\r\n        </view>\r\n        <view v-if=\"showOtherMenu\" class=\"dropdown-menu other-menu\" @tap.stop>\r\n          <view class=\"dropdown-item\">暂未开通，敬请期待</view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 协议勾选 -->\r\n    <view class=\"login-protocol\">\r\n      <text class=\"checkbox\" :class=\"{checked: checked}\" @tap=\"checked = !checked\">\r\n        <text v-if=\"checked\" class=\"iconfont icon-checked\"></text>\r\n        <text v-else class=\"iconfont icon-unchecked\"></text>\r\n      </text>\r\n      <view class=\"protocol-text\">\r\n        已阅读并同意\r\n        <text class=\"link-text\" hover-class=\"link-text-active\" @tap=\"goToAgreement('user-agreement')\">《用户协议》</text>\r\n        <text class=\"link-text\" hover-class=\"link-text-active\" @tap=\"goToAgreement('privacy-policy')\">《隐私政策》</text>\r\n        <text class=\"link-text\" hover-class=\"link-text-active\" @tap=\"goToAgreement('buyer-notice')\">《买家须知》</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { useUserStore } from '@/store/modules/user'\r\n\r\nconst userStore = useUserStore()\r\nconst showHelp = ref(false)\r\nconst showOtherMenu = ref(false)\r\nconst checked = ref(false)\r\nconst loginLoading = ref(false)\r\n\r\nconst toggleHelp = () => {\r\n  showHelp.value = !showHelp.value\r\n  showOtherMenu.value = false\r\n}\r\nconst toggleOtherMenu = () => {\r\n  showOtherMenu.value = !showOtherMenu.value\r\n  showHelp.value = false\r\n}\r\nconst goPhoneLogin = () => {\r\n  if (!checked.value) {\r\n    uni.showToast({\r\n      title: '请先阅读并同意相关协议',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n  uni.navigateTo({ url: '/pages/login/phone' })\r\n}\r\n\r\n// 跳转到协议页面\r\nconst goToAgreement = (type) => {\r\n  uni.navigateTo({\r\n    url: `/pages/agreement/${type}`\r\n  })\r\n}\r\n\r\n// 微信登录方法\r\nconst wxLogin = () => {\r\n  // 第一步：先判断是否勾选协议\r\n  if (!checked.value) {\r\n    uni.showToast({\r\n      title: '请先阅读并同意相关协议',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n\r\n  // 在这个同步作用域里直接调用 getUserProfile\r\n  uni.getUserProfile({\r\n    desc: '用于完善用户资料',\r\n    lang: 'zh_CN',\r\n    success: async (userInfoRes) => {\r\n      loginLoading.value = true\r\n      try {\r\n        // 获取微信 codes\r\n        const loginRes = await uni.login({ provider: 'weixin' })\r\n\r\n        // 调用后端微信登录\r\n        await userStore.wxLogin({\r\n          code: loginRes.code,\r\n          userInfo: userInfoRes.userInfo,\r\n          loginType: 'wechat',\r\n          encryptedData: userInfoRes.encryptedData,\r\n          iv: userInfoRes.iv\r\n        })\r\n\r\n        // 登录成功\r\n        uni.switchTab({\r\n          url: '/pages/user/home'\r\n        })\r\n\r\n        uni.showToast({\r\n          title: '登录成功',\r\n          icon: 'success'\r\n        })\r\n      } catch (error) {\r\n        console.error('登录失败', error)\r\n        uni.showToast({\r\n          title: error.message || '登录失败，请重试',\r\n          icon: 'none'\r\n        })\r\n      } finally {\r\n        loginLoading.value = false\r\n      }\r\n    },\r\n    fail: (err) => {\r\n      console.error('getUserProfile 授权失败：', err)\r\n      uni.showToast({\r\n        title: '用户拒绝授权',\r\n        icon: 'none'\r\n      })\r\n    }\r\n  })\r\n}\r\n</script>\r\n\r\n<style>\r\n@font-face {\r\n  font-family: 'iconfont';\r\n  src: url('/static/fonts/iconfont.ttf') format('truetype');\r\n}\r\n.iconfont {\r\n  font-family: 'iconfont';\r\n  font-size: 32rpx;\r\n}\r\n.login-container {\r\n  min-height: 100vh;\r\n  width: 750rpx; /* 使用固定宽度750rpx（等于100vw）确保占满屏幕 */\r\n  background-color: #585965;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  position: relative;\r\n  overflow: hidden; /* 防止毛玻璃效果溢出 */\r\n  padding: 0; /* 移除可能的内边距 */\r\n  margin: 0 -10rpx; /* 向两侧扩展10rpx覆盖可能的白边 */\r\n  box-sizing: border-box;\r\n  left: 0; /* 确保左对齐 */\r\n}\r\n\r\npage {\r\n  margin: 0;\r\n  padding: 0;\r\n  width: 100%;\r\n  overflow-x: hidden;\r\n  background-color: #585965;\r\n}\r\n\r\n/* 扩展背景色解决白边问题 */\r\nuni-page-body,\r\nuni-page-head,\r\nuni-page,\r\nuni-page-wrapper {\r\n  background-color: #585965 !important;\r\n}\r\n\r\n/* 背景装饰 - 增加模糊效果 */\r\n.login-container::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: -10rpx; /* 向左扩展 */\r\n  right: -10rpx; /* 向右扩展 */\r\n  bottom: 0;\r\n  background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 60%);\r\n  z-index: 0;\r\n}\r\n\r\n/* 增加背景淡化模糊层 */\r\n.login-container::after {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  left: -10rpx;\r\n  right: -10rpx;\r\n  bottom: 0;\r\n  background-color: rgba(255, 255, 255, 0.03);\r\n  backdrop-filter: blur(2px);\r\n  -webkit-backdrop-filter: blur(2px);\r\n  z-index: 0;\r\n}\r\n\r\n.login-header, .login-logo, .login-buttons-area, .login-protocol {\r\n  position: relative;\r\n  z-index: 1;\r\n  width: 100%;\r\n}\r\n\r\n.login-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: flex-start;\r\n  padding: 40rpx 40rpx 0 40rpx;\r\n  box-sizing: border-box;\r\n}\r\n.icon-back {\r\n  font-size: 48rpx;\r\n  color: #DB9EA2;\r\n}\r\n.login-help {\r\n  font-size: 28rpx;\r\n  color: #DB9EA2;\r\n  position: absolute;\r\n  right: 60rpx;\r\n  font-weight: 500;\r\n  letter-spacing: 0.5px;\r\n}\r\n.dropdown-menu {\r\n  position: absolute;\r\n  top: 60rpx;\r\n  right: 0;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  backdrop-filter: blur(10px);\r\n  -webkit-backdrop-filter: blur(10px);\r\n  border-radius: 16rpx;\r\n  box-shadow: 0 2rpx 12rpx rgba(0,0,0,0.15);\r\n  z-index: 10;\r\n  min-width: 220rpx;\r\n}\r\n.dropdown-item {\r\n  padding: 28rpx 40rpx;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  border-bottom: 1rpx solid rgba(240,240,240,0.5);\r\n}\r\n.dropdown-item:last-child { border-bottom: none; }\r\n\r\n/* Logo 区域 */\r\n.login-logo {\r\n  margin: 80rpx 0;\r\n  width: 312rpx;  /* 原240rpx的1.3倍 */\r\n  height: 312rpx;  /* 原240rpx的1.3倍 */\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background-color: transparent;\r\n  border-radius: 24rpx;\r\n}\r\n\r\n.login-logo image {\r\n  width: 260rpx;  /* 原200rpx的1.3倍 */\r\n  height: 260rpx;  /* 原200rpx的1.3倍 */\r\n  border-radius: 0;\r\n}\r\n\r\n/* 登录按钮区域 */\r\n.login-buttons-area {\r\n  padding: 0 40rpx;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-top: 220rpx; /* 增加下移距离 */\r\n}\r\n\r\n/* 微信一键登录按钮 - 改为粉色 */\r\n.login-btn.wx-btn {\r\n  width: 90%;\r\n  height: 90rpx;\r\n  background: rgba(219, 158, 162, 0.95); /* 粉色按钮 */\r\n  backdrop-filter: blur(5px); /* 毛玻璃效果 */\r\n  -webkit-backdrop-filter: blur(5px); /* Safari 支持 */\r\n  color: #fff;\r\n  font-size: 32rpx;\r\n  border-radius: 45rpx; /* 圆角 */\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-bottom: 32rpx;\r\n  box-shadow: 0 6rpx 16rpx rgba(0, 0, 0, 0.15);\r\n  border: none;\r\n  padding: 0;\r\n}\r\n\r\n/* 按钮内容容器 */\r\n.btn-content {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 100%;\r\n  position: relative;\r\n}\r\n\r\n/* 微信按钮中的白色图标 */\r\n.white-icon {\r\n  color: white !important; /* 使用!important确保覆盖其他样式 */\r\n  font-size: 40rpx;\r\n  margin-right: 8rpx;\r\n  position: relative;\r\n  left: -20rpx; /* 微调图标位置 */\r\n}\r\n\r\n/* 按钮文本样式 */\r\n.btn-text {\r\n  color: white;\r\n  font-weight: 600;\r\n  letter-spacing: 2rpx;\r\n}\r\n\r\n/* 手机号登录 */\r\n.login-phone {\r\n  color: #DB9EA2;\r\n  font-size: 32rpx; /* 增大字号 */\r\n  margin-bottom: 80rpx;\r\n  text-align: center;\r\n  font-weight: 500;\r\n  letter-spacing: 0.5px;\r\n}\r\n\r\n/* 其他登录方式 */\r\n.login-other-title {\r\n  color: rgba(219, 158, 162, 0.8);\r\n  font-size: 28rpx; /* 增大字号 */\r\n  margin-bottom: 32rpx;\r\n  margin-top: 20rpx;\r\n  font-weight: 500;\r\n  letter-spacing: 0.5px;\r\n}\r\n.login-other-icons {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 100rpx; /* 增加图标间距 */\r\n  margin-bottom: 60rpx;\r\n  position: relative;\r\n}\r\n.icon-wrap {\r\n  width: 72rpx;\r\n  height: 72rpx;\r\n  background: rgba(255, 255, 255, 0.15);\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  backdrop-filter: blur(5px);\r\n  -webkit-backdrop-filter: blur(5px);\r\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n/* 图标样式 */\r\n.icon-wechat:before { content: '\\e616'; font-size: 40rpx; color: #DB9EA2; }\r\n.icon-weibo:before { content: '\\e63e'; font-size: 38rpx; color: #DB9EA2; }\r\n.icon-qq:before { content: '\\e623'; font-size: 38rpx; color: #DB9EA2; }\r\n\r\n/* 确保微信登录按钮中的图标为白色 */\r\n.login-btn.wx-btn .icon-wechat:before {\r\n  color: white !important; /* 强制为白色 */\r\n}\r\n\r\n.other-menu {\r\n  left: 0;\r\n  right: 0;\r\n  top: 80rpx;\r\n  min-width: 200rpx;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  backdrop-filter: blur(10px);\r\n  -webkit-backdrop-filter: blur(10px);\r\n}\r\n\r\n/* 协议区域 */\r\n.login-protocol {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 24rpx;\r\n  margin-top: auto;\r\n  margin-bottom: 40rpx;\r\n  width: 90vw;\r\n  position: absolute;\r\n  bottom: 0;\r\n  padding: 20rpx 0;\r\n  font-weight: 500;\r\n  letter-spacing: 0.5px;\r\n}\r\n.checkbox {\r\n  width: 36rpx;\r\n  height: 36rpx;\r\n  border-radius: 50%;\r\n  border: 2rpx solid #DB9EA2;\r\n  margin-right: 16rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background: transparent;\r\n}\r\n.checkbox.checked {\r\n  border-color: #DB9EA2;\r\n  background: #DB9EA2;\r\n}\r\n.icon-checked:before { content: '\\2714'; color: #fff; font-size: 28rpx; }\r\n.icon-unchecked:before { content: ''; }\r\n.protocol-text {\r\n  color: #DB9EA2;\r\n  font-size: 24rpx;\r\n  font-weight: 500;\r\n  letter-spacing: 0.5px;\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.link-text {\r\n  color: #DB9EA2;\r\n  text-decoration: none;\r\n  margin: 0 4rpx;\r\n}\r\n\r\n.link-text-active {\r\n  text-decoration: underline;\r\n}\r\n</style>","import MiniProgramPage from 'D:/Git clone/TravelDiaryPlatform/app/rednote/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","uni","MiniProgramPage"],"mappings":";;;;;;;AAqEA,UAAM,YAAYA,mBAAAA,aAAc;AAChC,UAAM,WAAWC,cAAG,IAAC,KAAK;AAC1B,UAAM,gBAAgBA,cAAG,IAAC,KAAK;AAC/B,UAAM,UAAUA,cAAG,IAAC,KAAK;AACzB,UAAM,eAAeA,cAAG,IAAC,KAAK;AAE9B,UAAM,aAAa,MAAM;AACvB,eAAS,QAAQ,CAAC,SAAS;AAC3B,oBAAc,QAAQ;AAAA,IACxB;AACA,UAAM,kBAAkB,MAAM;AAC5B,oBAAc,QAAQ,CAAC,cAAc;AACrC,eAAS,QAAQ;AAAA,IACnB;AACA,UAAM,eAAe,MAAM;AACzB,UAAI,CAAC,QAAQ,OAAO;AAClBC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AACDA,oBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAoB,CAAE;AAAA,IAC9C;AAGA,UAAM,gBAAgB,CAAC,SAAS;AAC9BA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,oBAAoB,IAAI;AAAA,MACjC,CAAG;AAAA,IACH;AAGA,UAAM,UAAU,MAAM;AAEpB,UAAI,CAAC,QAAQ,OAAO;AAClBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AAGDA,oBAAAA,MAAI,eAAe;AAAA,QACjB,MAAM;AAAA,QACN,MAAM;AAAA,QACN,SAAS,OAAO,gBAAgB;AAC9B,uBAAa,QAAQ;AACrB,cAAI;AAEF,kBAAM,WAAW,MAAMA,cAAG,MAAC,MAAM,EAAE,UAAU,UAAU;AAGvD,kBAAM,UAAU,QAAQ;AAAA,cACtB,MAAM,SAAS;AAAA,cACf,UAAU,YAAY;AAAA,cACtB,WAAW;AAAA,cACX,eAAe,YAAY;AAAA,cAC3B,IAAI,YAAY;AAAA,YAC1B,CAAS;AAGDA,0BAAAA,MAAI,UAAU;AAAA,cACZ,KAAK;AAAA,YACf,CAAS;AAEDA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAChB,CAAS;AAAA,UACF,SAAQ,OAAO;AACdA,0BAAAA,MAAc,MAAA,SAAA,gCAAA,QAAQ,KAAK;AAC3BA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO,MAAM,WAAW;AAAA,cACxB,MAAM;AAAA,YAChB,CAAS;AAAA,UACT,UAAgB;AACR,yBAAa,QAAQ;AAAA,UACtB;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAc,MAAA,SAAA,gCAAA,wBAAwB,GAAG;AACzCA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7JA,GAAG,WAAWC,SAAe;"}