{"version":3,"file":"user.js","sources":["store/modules/user.js"],"sourcesContent":["import { defineStore } from 'pinia'\r\nimport { login } from '@/api/user'\r\n\r\nexport const useUserStore = defineStore('user', {\r\n  state: () => ({\r\n    token: uni.getStorageSync('token') || '',\r\n    userInfo: uni.getStorageSync('userInfo') || {\r\n      email: '',\r\n      username: '',\r\n      avatar: '',\r\n      bio: '',\r\n      posts: 0,\r\n      followers: 0,\r\n      following: 0\r\n    },\r\n    isLogin: !!uni.getStorageSync('token')\r\n  }),\r\n\r\n  getters: {\r\n    getToken: (state) => state.token,\r\n    getUserInfo: (state) => state.userInfo,\r\n    getIsLogin: (state) => state.isLogin,\r\n    getUsername: (state) => state.userInfo.username,\r\n    getAvatar: (state) => state.userInfo.avatar\r\n  },\r\n\r\n  actions: {\r\n    setToken(token) {\r\n      this.token = token\r\n      uni.setStorageSync('token', token)\r\n    },\r\n\r\n    setUserInfo(userInfo) {\r\n      this.userInfo = userInfo\r\n      uni.setStorageSync('userInfo', userInfo)\r\n    },\r\n\r\n    setLoginStatus(status) {\r\n      this.isLogin = status\r\n    },\r\n\r\n    clearUserData() {\r\n      this.token = ''\r\n      this.userInfo = {\r\n        email: '',\r\n        username: '',\r\n        avatar: '',\r\n        bio: '',\r\n        posts: 0,\r\n        followers: 0,\r\n        following: 0\r\n      }\r\n      this.isLogin = false\r\n      uni.removeStorageSync('token')\r\n      uni.removeStorageSync('userInfo')\r\n    },\r\n\r\n    // 微信登录\r\n    async wxLogin(loginData) {\r\n      try {\r\n        const response = await login(loginData)\r\n        if (response.data && response.data.token) {\r\n          this.setToken(response.data.token)\r\n          this.setUserInfo(response.data.userInfo)\r\n          this.setLoginStatus(true)\r\n          return Promise.resolve(response.data)\r\n        }\r\n      } catch (error) {\r\n        return Promise.reject(error)\r\n      }\r\n    },\r\n\r\n    // 更新用户信息\r\n    updateUserInfo(userInfo) {\r\n      this.setUserInfo(userInfo)\r\n    },\r\n\r\n    // 退出登录\r\n    logout() {\r\n      this.clearUserData()\r\n    }\r\n  }\r\n})"],"names":["defineStore","uni","login"],"mappings":";;;AAGY,MAAC,eAAeA,cAAW,YAAC,QAAQ;AAAA,EAC9C,OAAO,OAAO;AAAA,IACZ,OAAOC,cAAG,MAAC,eAAe,OAAO,KAAK;AAAA,IACtC,UAAUA,cAAG,MAAC,eAAe,UAAU,KAAK;AAAA,MAC1C,OAAO;AAAA,MACP,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,KAAK;AAAA,MACL,OAAO;AAAA,MACP,WAAW;AAAA,MACX,WAAW;AAAA,IACZ;AAAA,IACD,SAAS,CAAC,CAACA,oBAAI,eAAe,OAAO;AAAA,EACzC;AAAA,EAEE,SAAS;AAAA,IACP,UAAU,CAAC,UAAU,MAAM;AAAA,IAC3B,aAAa,CAAC,UAAU,MAAM;AAAA,IAC9B,YAAY,CAAC,UAAU,MAAM;AAAA,IAC7B,aAAa,CAAC,UAAU,MAAM,SAAS;AAAA,IACvC,WAAW,CAAC,UAAU,MAAM,SAAS;AAAA,EACtC;AAAA,EAED,SAAS;AAAA,IACP,SAAS,OAAO;AACd,WAAK,QAAQ;AACbA,0BAAI,eAAe,SAAS,KAAK;AAAA,IAClC;AAAA,IAED,YAAY,UAAU;AACpB,WAAK,WAAW;AAChBA,0BAAI,eAAe,YAAY,QAAQ;AAAA,IACxC;AAAA,IAED,eAAe,QAAQ;AACrB,WAAK,UAAU;AAAA,IAChB;AAAA,IAED,gBAAgB;AACd,WAAK,QAAQ;AACb,WAAK,WAAW;AAAA,QACd,OAAO;AAAA,QACP,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,KAAK;AAAA,QACL,OAAO;AAAA,QACP,WAAW;AAAA,QACX,WAAW;AAAA,MACZ;AACD,WAAK,UAAU;AACfA,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,UAAU;AAAA,IACjC;AAAA;AAAA,IAGD,MAAM,QAAQ,WAAW;AACvB,UAAI;AACF,cAAM,WAAW,MAAMC,SAAK,MAAC,SAAS;AACtC,YAAI,SAAS,QAAQ,SAAS,KAAK,OAAO;AACxC,eAAK,SAAS,SAAS,KAAK,KAAK;AACjC,eAAK,YAAY,SAAS,KAAK,QAAQ;AACvC,eAAK,eAAe,IAAI;AACxB,iBAAO,QAAQ,QAAQ,SAAS,IAAI;AAAA,QACrC;AAAA,MACF,SAAQ,OAAO;AACd,eAAO,QAAQ,OAAO,KAAK;AAAA,MAC5B;AAAA,IACF;AAAA;AAAA,IAGD,eAAe,UAAU;AACvB,WAAK,YAAY,QAAQ;AAAA,IAC1B;AAAA;AAAA,IAGD,SAAS;AACP,WAAK,cAAe;AAAA,IACrB;AAAA,EACF;AACH,CAAC;;"}